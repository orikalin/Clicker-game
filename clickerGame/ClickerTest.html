<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="clicker_ss.css">
    <title>dragon clicker</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

</head>

<body>
    <div class="nav" id="nav"></div>

    <div class="wrapper" id="wrapper">
        <canvas id="canvasDragon" class="canvasDragon" width="600" height="500"></canvas>
        <div class="borderPins">
            <div class="borderPinHL1"></div>
            <div class="borderPinHL2"></div>
            <div class="borderPinHR1"></div>
            <div class="borderPinFull"></div>
            <div class="borderPinBot1"></div>
            <div class="borderPinBot2"></div>
            <div class="borderPinBot3"></div>
            <div class="borderPinTop1"></div>
            <div class="borderPinTop2"></div>
            <div class="borderPinTop3"></div>

        </div>
        <div class="borders">
            <div class="hBorder1"></div>
            <div class="hBorder2"></div>
            <div class="vBorder1"></div>
            <div class="vBorder2"></div>
            <div class="vBorder3"></div>
            <div class="hBorderBtm"></div>
        </div>
        <div class="leftSection" id="leftSection">
            <div class="dragonArea" id="dragonArea">
                <div id="animations"></div>
                <div class="goldWrapper">
                    <div id="goldDisplay" class="goldDisplay"> Gold: 0</div>
                    <div id="gpsDisplay" class="gpsDisplay" style="font-size:50%;">Gold per second : 0</div>
                </div>
                <div class="dragonAnchor">
                    <div id="theDragon" class="theDragon"></div>
                </div>
                <div id="toolTipWindow" class="toolTipWindow">
                    <div class="ttIcon"></div><img class="coinStack" src="art/coinStack.png">
                    <div class="ttName"></div><br>
                    <div class="ttDesc"></div>
                </div>
            </div>

            <div class="playerArea" id="playerArea">
                <div class="namePlate">
                    <div id="changeNamePlate" onclick="changeName()">Change</div>
                    <div class="playerName"></div>
                </div>
                <div id="stats" class="stats">Gold Per Click - TT should eventually include sources<br>Damage - TT includes gold gained by damage<br>Crit rate - TT includes gold on crit <br></div>
                <div class="playerAnchor">
                    <div id="thePlayer" class="thePlayer"></div>
                </div>
            </div>
        </div>
        <div class="shopSection" id="shopSection">
            <div class="shopHeader">Shop graphics go here</div>
            <div class="shopWrapper">
                <div class="theShop">
                    <div id="ironSword" class="ironSword shopItem shadowedItem" onmouseover='ironSwordObj.showToolTip()' onmouseout="ttClear()" onclick="ironSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="steelSword" class="steelSword shopItem shadowedItem shopHidden" onmouseover='steelSwordObj.showToolTip()' onmouseout="ttClear()" onclick="steelSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="boneSword" class="boneSword shopItem shadowedItem shopHidden" onmouseover='boneSwordObj.showToolTip()' onmouseout="ttClear()" onclick="boneSwordObj.buyFlatUpgradeItem()"></div>
                </div>
            </div>
        </div>
        <div id="guildSection" class="guildSection">
            <div class="guildHeader">Guild graphics go here</div>
            <div class="guildWrapper">
                <div class="theGuild">
                    <div class="newbTT" onmouseover="newbObj.showToolTip()" onmouseout="ttClear()">
                        <div id="newb" class="newb shadowed gBevel" onclick="newbObj.buy()">
                            <div class="newbCount gCount">0</div>
                            <div class="newbCost gCost">10</div>
                        </div>
                    </div>
                    <div class="mercTT" onmouseover="mercObj.showToolTip()" onmouseout="ttClear()">
                        <div id="merc" class="merc shadowed bStyle gBevel guildHidden" onclick="mercObj.buy()">
                            <div class="mercCount gCount"></div>
                            <div class="mercCost gCost"></div>
                        </div>
                    </div>
                    <div class="koboldsTT" onmouseover="koboldObj.showToolTip()" onmouseout="ttClear()">
                        <div id="kobold" class="kobold shadowed bStyle gBevel guildHidden" onclick="koboldObj.buy()">
                            <div class="koboldCount gCount"></div>
                            <div class="koboldCost gCost"></div>
                        </div>
                    </div>
                    <div class="roguesTT" onmouseover="rogueObj.showToolTip()" onmouseout="ttClear()">
                        <div id="rogue" class="rogue shadowed bStyle gBevel guildHidden" onclick="rogueObj.buy()">
                            <div class="rogueCount gCount"></div>
                            <div class="rogueCost gCost"></div>
                        </div>
                    </div>
                    <div class="proHunterTT" onmouseover="proHunterObj.showToolTip()" onmouseout="ttClear()">
                        <div id="proHunter" class="proHunter shadowed bStyle gBevel guildHidden" onclick="proHunterObj.buy()">
                            <div class="proHunterCount gCount"></div>
                            <div class="proHunterCost gCost"></div>
                        </div>
                    </div>
                    <div class="jRPGProtagTT" onmouseover="jRPGProtagObj.showToolTip()" onmouseout="ttClear()">
                        <div id="jRPGProtag" class="jRPGProtag shadowed bStyle gBevel guildHidden" onclick="jRPGProtagObj.buy()">
                            <div class="jRPGProtagCount gCount"></div>
                            <div class="jRPGProtagCost gCost"></div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>



    <script>
        function QS(e) {
            return document.querySelector(e)
        }
        class guildRecruit {
            constructor(type, cost, count, costEle, countEle, costMult, multFloor, gpsI, title, desc) {
                this.type = type
                this.cost = cost
                this.count = count
                this.costEle = costEle
                this.countEle = countEle
                this.costMult = costMult
                this.multFloor = multFloor
                this.gpsI = gpsI
                this.title = title
                this.desc = desc
            }

            priceCheckGuild() {
                if (this.cost <= gold) {
                    this.type.classList.remove("shadowed")
                } else {
                    this.type.classList.add("shadowed")
                }
            }

            buy() {
                if (gold >= this.cost) {
                    gold = gold - this.cost
                    this.count = this.count + 1
                    this.cost = this.cost + Number((this.cost * this.costMult).toFixed(0))
                    this.costMult = this.costMult - 0.05
                    if (this.costMult < this.multFloor) {
                        this.costMult = this.multFloor
                    }
                    QS(this.countEle).innerText = this.count
                    QS(this.costEle).innerText = this.cost
                    gps = gps + this.gpsI
                    gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                    gpsDisplay.innerHTML = `Gold per second : ${gps}`
                }

            }
            update() {
                QS(this.countEle).innerText = this.count
                QS(this.costEle).innerText = this.cost
                this.type.classList.remove("guildHidden")
            }
            reveal() {
                if (gold * 2 >= this.cost) {
                    this.type.classList.remove("guildHidden")
                    QS(this.countEle).innerText = this.count
                    QS(this.costEle).innerText = this.cost
                }
            }
            showToolTip() {
                ttWindow.style.display = "block"
                ttWindow.childNodes[1].innerText = ""
                ttWindow.childNodes[2].src = ""
                ttWindow.childNodes[4].innerText = this.title
                ttWindow.childNodes[7].innerText = this.desc
            }
        }

        class shopItem {
            constructor(type, cost, title, desc) {
                this.type = type
                this.cost = cost
                this.title = title
                this.desc = desc
            }
            priceCheckItem() {
                if (this.cost <= gold) {
                    this.type.classList.remove("shadowedItem")
                } else {
                    this.type.classList.add("shadowedItem")
                }
            }
            buyFlatUpgradeItem() {
                if (this.cost <= gold) {
                    gold = gold - this.cost
                    flatClickUpgrades++
                    this.type.classList.add("shopDisable")
                }
            }
            buyRateUpgradeItem() {
                if (this.cost <= gold) {
                    gold = gold - this.cost
                    rateClickUpgrades = rateClickUpgrades + 0.01
                    this.type.classList.add("shopDisable")
                }
            }
            revealItem() {
                if (gold * 2 >= this.cost) {
                    this.type.classList.remove("shopHidden")
                }
            }
            showToolTip() {
                ttWindow.style.display = "block"
                ttWindow.childNodes[1].innerText = this.cost
                ttWindow.childNodes[2].src = "art/coinStack.png"
                ttWindow.childNodes[4].innerText = this.title
                ttWindow.childNodes[7].innerText = this.desc
            }
        }


        function ttClear() {
            ttWindow.style.display = "none"
        }

        function rngInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive 
        }

        function dClicked(e) {
            posX = e.clientX
            posY = e.clientY
            finalGpc = gpc + flatClickUpgrades + (gpc * rateClickUpgrades)
            gold = gold + finalGpc
            gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
            var goldAnim = $('<div  class="animation anim" style="top:' + (posY - 10) + 'px; left:' + (posX + rngInt(-25, -5)) + 'px">+' + finalGpc + '</div>');
            var damageAnim = $('<div  class="animation2 anim" style="top:' + (posY + rngInt(0, 20)) + 'px; left:' + (posX + rngInt(0, 40)) + 'px"></div>');

            $('#animations').append(goldAnim);
            $('#animations').append(damageAnim);
            $('#animations').on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd", '.anim',
                function() {
                    $(this).off();
                    $(this).remove();
                });

        }

        var GAME_TICK = 1; //interval speed
        var gameInterval;
        var smallUpdateTime = 0;
        var bigUpdateTime = 0;
        var saveUpdateTime = 0;
        var currentInterval
        var delta
        var smallInterval
        var largeInterval
        var oldInterval
        var fpsInterval
        var fpsUpdate = 0
        const theDragon = document.getElementById("theDragon")
        theDragon.addEventListener('click', dClicked)
            //Guild Objs-----------
            //elementID, cost, count, costElementClass, CountElementClass, costMultiplier, multiplierFloor, gpsIncrease, tooltip title, tooltip description
        const newbObj = new guildRecruit(newb, 10, 0, ".newbCost", ".newbCount", 0.5, 0.1, 1, "Newbie", "Ready for their first adventure,\ncomplete with red shirt!\n\n+1 gold per second")
        const mercObj = new guildRecruit(merc, 100, 0, ".mercCost", ".mercCount", 0.5, 0.15, 5, "Mercenary", "A slightly more experienced adventurer.\nOnly slighty.\n\n+5 gold per second")
        const koboldObj = new guildRecruit(kobold, 500, 0, ".koboldCost", ".koboldCount", 0.5, 0.15, 25, "Kobold", "I'm not sure how they got past guild\nregistration, but they're really good at\nhoarding gold!\n\n+25 gold per second")
        const rogueObj = new guildRecruit(rogue, 5000, 0, ".rogueCost", ".rogueCount", 0.4, 0.2, 100, "Rogue", "Stealing gold is literally their job.\n\n+100 gold per second")
        const proHunterObj = new guildRecruit(proHunter, 50000, 0, ".proHunterCost", ".proHunterCount", 0.05, 0.25, 500, "Professional Hunter", "The best gear.\nThe best stats.\nThe best DPS.\nbut at what cost?\n\n+500 gold per second\n+1 second-hand embarassment.")
        const jRPGProtagObj = new guildRecruit(jRPGProtag, 99999, 0, ".jRPGProtagCost", ".jRPGProtagCount", 0.5, 0.25, 999, "jRPG Protagonist", "\n彼は殺されるなどの小さなことで死ぬことはありません。\n\n+999 gold per second")

        //Item Objs-----------
        //type, cost, tooltip title, tooltip description
        const ironSwordObj = new shopItem(ironSword, 600, "Iron Sword", "Not sure what you were using before...\n\n+1 Gold per click")
        const steelSwordObj = new shopItem(steelSword, 6000, "Steel Sword", "A slight improvment\n\n+1 Gold per click")
        const boneSwordObj = new shopItem(boneSword, 60000, "Bone Sword", "Numbers don't lie.\n\n+1 Gold per click")

        var ttWindow = QS(".toolTipWindow")
        var gDisplay = QS(".goldDisplay")
        var playerName = QS(".playerName")
        var gold = 0
        var upgrades = 0
        var gpc = 1
        var gps = 0
        var clickPos = Array()
        var flatClickUpgrades = 0
        var rateClickUpgrades = 0 //Number((gps * 0.01).toFixed(0)), used for percentage click upgrades
        var dCanvas = document.getElementById("canvasDragon")
        var ctx = dCanvas.getContext("2d")
        ctx.font = "30px IMMORTAL"
        ctx.fillStyle = 'white';


        function updateGold() {
            gold = gold + (gps / 10)
            gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
            gpsDisplay.innerHTML = `Gold per second : ${gps}`
        }

        function updateOtherStuff() {
            newbObj.priceCheckGuild()
            mercObj.priceCheckGuild()
            koboldObj.priceCheckGuild()
            rogueObj.priceCheckGuild()
            proHunterObj.priceCheckGuild()
            jRPGProtagObj.priceCheckGuild()
            ironSwordObj.priceCheckItem()
            steelSwordObj.priceCheckItem()
            boneSwordObj.priceCheckItem()
            mercObj.reveal()
            koboldObj.reveal()
            rogueObj.reveal()
            proHunterObj.reveal()
            jRPGProtagObj.reveal()
            steelSwordObj.revealItem()
            boneSwordObj.revealItem()
        }

        function changeName() {
            playerName.innerText = prompt("What is your name?")
        }

        function clear() {
            ctx.clearRect(0, 0, dCanvas.width, dCanvas.height)
        }

        function saveGame() {
            var save = {
                gold: gold,
                gps: gps,
                flatClickUpgrades: flatClickUpgrades,
                rateClickUpgrades: rateClickUpgrades,
                newbCost: newbObj.cost,
                newbCount: newbObj.count,
                newbClass: newbObj.type.classList.value,
                mercCost: mercObj.cost,
                mercCount: mercObj.count,
                mercClass: mercObj.type.classList.value,
                koboldCost: koboldObj.cost,
                koboldCount: koboldObj.count,
                koboldClass: koboldObj.type.classList.value,
                rogueCost: rogueObj.cost,
                rogueCount: rogueObj.count,
                rogueClass: rogueObj.type.classList.value,
                proHunterCost: proHunterObj.cost,
                proHunterCount: proHunterObj.count,
                proHunterClass: proHunterObj.type.classList.value,
                jRPGProtagCost: jRPGProtagObj.cost,
                jRPGProtagCount: jRPGProtagObj.count,
                jRPGProtagClass: jRPGProtagObj.type.classList.value,
                ironSword: ironSwordObj.type.classList.value,
                steelSword: steelSwordObj.type.classList.value,
                boneSword: boneSwordObj.type.classList.value
            }
            localStorage.setItem("save", JSON.stringify(save));
            console.log(save)
        }

        function rLoadTest(saveVarCost, saveVarCount, obj, clist) {
            if (typeof saveVarCost !== "undefined") {
                obj.cost = saveVarCost
            }
            if (typeof saveVarCount !== "undefined") {
                obj.count = saveVarCount
            }
            console.log(clist)
            if (clist.search("guildHidden") == -1) {
                obj.update()
            }


        }

        function iLoadTest(obj, clist) {
            if (typeof clist !== "undefined") {
                obj.type.classList = clist
            }
        }

        function loadGame() {
            var savegame = JSON.parse(localStorage.getItem("save"));
            console.log(savegame)
            if (typeof savegame.gold !== "undefined") gold = savegame.gold;
            if (typeof savegame.gps !== "undefined") gps = savegame.gps;
            if (typeof savegame.flatClickUpgrades !== "undefined") flatClickUpgrades = savegame.flatClickUpgrades;
            if (typeof savegame.rateClickUpgrades !== "undefined") rateClickUpgrades = savegame.rateClickUpgrades;
            rLoadTest(savegame.newbCost, savegame.newbCount, newbObj, savegame.newbClass)
            rLoadTest(savegame.mercCost, savegame.mercCount, mercObj, savegame.mercClass)
            rLoadTest(savegame.koboldCost, savegame.koboldCount, koboldObj, savegame.koboldClass)
            rLoadTest(savegame.rogueCost, savegame.rogueCount, rogueObj, savegame.rogueClass)
            rLoadTest(savegame.proHunterCost, savegame.proHunterCount, proHunterObj, savegame.proHunterClass)
            rLoadTest(savegame.jRPGProtagCost, savegame.jRPGProtagCount, jRPGProtagObj, savegame.jRPGProtagClass)
            iLoadTest(ironSwordObj, savegame.ironSword)
            iLoadTest(steelSwordObj, savegame.steelSword)
            iLoadTest(boneSwordObj, savegame.boneSword)

            /* if (typeof savegame.mercObj !== "undefined") mercObj = savegame.mercObj;
            if (typeof savegame.koboldObj !== "undefined") koboldObj = savegame.koboldObj;
            if (typeof savegame.rogueObj !== "undefined") rogueObj = savegame.rogueObj;
            if (typeof savegame.proHunterObj !== "undefined") proHunterObj = savegame.proHunterObj;
            if (typeof savegame.jRPGProtagObj !== "undefined") jRPGProtagObj = savegame.jRPGProtagObj;
            if (typeof savegame.ironSwordObj !== "undefined") ironSwordObj = savegame.ironSwordObj;
            if (typeof savegame.steelSwordObj !== "undefined") steelSwordObj = savegame.steelSwordObj;
            if (typeof savegame.boneSwordObj !== "undefined") boneSwordObj = savegame.boneSwordObj;
            if (typeof savegame.flatClickUpgrades !== "undefined") flatClickUpgrades = savegame.flatClickUpgrades;
            if (typeof savegame.rateClickUpgrades !== "undefined") rateClickUpgrades = savegame.rateClickUpgrades; */

        }

        function deleteSave() {
            localStorage.removeItem("save")
            window.location.reload(true);
        }

        function onGameTick() {
            // Update the timing
            currentInterval = Date.now();
            delta = currentInterval - oldInterval; // currently unused, but can be used in the future to handle things
            oldInterval = currentInterval; // that happen while the game is closed

            smallInterval = currentInterval - smallUpdateTime; //this starts as 0
            largeInterval = currentInterval - bigUpdateTime; //this too
            fpsInterval = currentInterval - fpsUpdate;
            saveInterval = currentInterval - saveUpdateTime;
            if (fpsInterval >= 1000 / 30) {
                fpsUpdate = currentInterval;
                clear();
            }

            if (smallInterval >= 98) {
                smallUpdateTime = currentInterval;
                updateGold();
            }

            if (largeInterval >= 250) {
                bigUpdateTime = currentInterval;
                updateOtherStuff();

            }
            if (saveInterval >= 5000) {
                saveUpdateTime = currentInterval;
                saveGame();
            }
        };

        function onStartup() {
            if (gameInterval) { //if an interval is set for some reason, clear it
                clearInterval(gameInterval);
                gameInterval = null;
            }
            gameInterval = setInterval(onGameTick, GAME_TICK); // do the things in onGameTick at the rate of GAME_TICK
            loadGame();
        }

        function onShutdown() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
        }


        onStartup();
    </script>
</body>

</html>