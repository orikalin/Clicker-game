<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="clicker_ss.css">
    <title>dragon clicker</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-158735968-1"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'UA-158735968-1');
    </script>


</head>

<body>
    <div class="nav" id="nav"></div>

    <div class="wrapper" id="wrapper">
        <div class="borderPins">
            <div class="borderPinHL1"></div>
            <div class="borderPinHL2"></div>
            <div class="borderPinHR1"></div>
            <div class="borderPinFull"></div>
            <div class="borderPinHL3"></div>
            <div class="borderPinBot1"></div>
            <div class="borderPinBot2"></div>
            <div class="borderPinBot3"></div>
            <div class="borderPinTop1"></div>
            <div class="borderPinTop2"></div>
            <div class="borderPinTop3"></div>

        </div>
        <div class="borders">
            <div class="hBorder1"></div>
            <div class="hBorder2"></div>
            <div class="vBorder1"></div>
            <div class="vBorder2"></div>
            <div class="vBorder3"></div>
            <div class="hBorderBtm"></div>
        </div>
        <div class="leftSection" id="leftSection">
            <div class="dragonArea" id="dragonArea">
                <div id="animations"></div>
                <div class="goldWrapper">
                    <div id="goldDisplay" class="goldDisplay"> Gold: 0</div>
                    <div id="gpsDisplay" class="gpsDisplay" style="font-size:50%;">Gold per second : 0</div>
                </div>
                <div class="dragonAnchor">
                    <div id="theDragon" class="theDragon disable-dbl-tap-zoom"></div>
                </div>
                <div id="toolTipWindow" class="toolTipWindow">
                    <div class="ttIcon"></div><img class="coinStack" src="art/coinStack.png">
                    <div class="ttName"></div><br>
                    <div class="ttDesc"></div>
                </div>
            </div>

            <div class="playerArea" id="playerArea">
                <div class="namePlate">
                    <div id="changeNamePlate" onclick="changeName()">Change</div>
                    <div class="playerName"></div>
                </div>
                <div id="stats" class="stats">Stats readout coming soon!</div>
                <div class="playerAnchor">
                    <div id="thePlayer" class="thePlayer"></div>
                </div>
            </div>
        </div>
        <div class="shopSection" id="shopSection">
            <div class="shopHeader">Shop graphics go here</div>
            <div class="shopWrapper">
                <div class="theShop">
                    <div id="ironSword" class="ironSword shopItem shadowedItem" onmouseover='ironSwordObj.showToolTip()' onmouseout="ttClear()" onclick="ironSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="steelSword" class="steelSword shopItem shadowedItem shopHidden" onmouseover='steelSwordObj.showToolTip()' onmouseout="ttClear()" onclick="steelSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="boneSword" class="boneSword shopItem shadowedItem shopHidden" onmouseover='boneSwordObj.showToolTip()' onmouseout="ttClear()" onclick="boneSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="greatSword" class="greatSword shopItem shadowedItem shopHidden" onmouseover='greatSwordObj.showToolTip()' onmouseout="ttClear()" onclick="greatSwordObj.buyFlatUpgradeItem()"></div>
                    <div id="goldenLoop" class="goldenLoop shopItem shadowedItem" onmouseover='goldenLoopObj.showToolTip()' onmouseout="ttClear()" onclick="goldenLoopObj.buyRateUpgradeItem()"></div>
                    <div id="ringOfMidas" class="ringOfMidas shopItem shadowedItem shopHidden" onmouseover='ringOfMidasObj.showToolTip()' onmouseout="ttClear()" onclick="ringOfMidasObj.buyRateUpgradeItem()"></div>
                    <div id="newbManual1" class="newbManual1 shopItem shadowedItem shopHidden" onmouseover='newbManual1Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual1Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual2" class="newbManual2 shopItem shadowedItem shopHidden" onmouseover='newbManual2Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual2Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual3" class="newbManual3 shopItem shadowedItem shopHidden" onmouseover='newbManual3Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual3Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual4" class="newbManual4 shopItem shadowedItem shopHidden" onmouseover='newbManual4Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual4Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual5" class="newbManual5 shopItem shadowedItem shopHidden" onmouseover='newbManual5Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual5Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual6" class="newbManual6 shopItem shadowedItem shopHidden" onmouseover='newbManual6Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual6Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual7" class="newbManual7 shopItem shadowedItem shopHidden" onmouseover='newbManual7Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual7Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual8" class="newbManual8 shopItem shadowedItem shopHidden" onmouseover='newbManual8Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual8Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual9" class="newbManual9 shopItem shadowedItem shopHidden" onmouseover='newbManual9Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual9Obj.buyGuildUpgrade()"></div>
                    <div id="newbManual10" class="newbManual10 shopItem shadowedItem shopHidden" onmouseover='newbManual10Obj.showToolTip()' onmouseout="ttClear()" onclick="newbManual10Obj.buyGuildUpgrade()"></div>
                    <div id="mercGear1" class="mercGear1 shopItem shadowedItem shopHidden" onmouseover='mercGear1Obj.showToolTip()' onmouseout="ttClear()" onclick="mercGear1Obj.buyGuildUpgrade()"></div>
                    <div id="mercGear2" class="mercGear2 shopItem shadowedItem shopHidden" onmouseover='mercGear2Obj.showToolTip()' onmouseout="ttClear()" onclick="mercGear2Obj.buyGuildUpgrade()"></div>
                    <div id="mercGear3" class="mercGear3 shopItem shadowedItem shopHidden" onmouseover='mercGear3Obj.showToolTip()' onmouseout="ttClear()" onclick="mercGear3Obj.buyGuildUpgrade()"></div>
                    <div id="mercGear4" class="mercGear4 shopItem shadowedItem shopHidden" onmouseover='mercGear4Obj.showToolTip()' onmouseout="ttClear()" onclick="mercGear4Obj.buyGuildUpgrade()"></div>
                    <div id="mercGear5" class="mercGear5 shopItem shadowedItem shopHidden" onmouseover='mercGear5Obj.showToolTip()' onmouseout="ttClear()" onclick="mercGear5Obj.buyGuildUpgrade()"></div>
                    <div id="koboldHat1" class="koboldHat1 shopItem shadowedItem shopHidden" onmouseover='koboldHat1Obj.showToolTip()' onmouseout="ttClear()" onclick="koboldHat1Obj.buyGuildUpgrade()"></div>
                    <div id="koboldHat2" class="koboldHat2 shopItem shadowedItem shopHidden" onmouseover='koboldHat2Obj.showToolTip()' onmouseout="ttClear()" onclick="koboldHat2Obj.buyGuildUpgrade()"></div>
                    <div id="koboldHat3" class="koboldHat3 shopItem shadowedItem shopHidden" onmouseover='koboldHat3Obj.showToolTip()' onmouseout="ttClear()" onclick="koboldHat3Obj.buyGuildUpgrade()"></div>
                    <div id="koboldHat4" class="koboldHat4 shopItem shadowedItem shopHidden" onmouseover='koboldHat4Obj.showToolTip()' onmouseout="ttClear()" onclick="koboldHat4Obj.buyGuildUpgrade()"></div>
                    <div id="roguePoison1" class="roguePoison1 shopItem shadowedItem shopHidden" onmouseover='roguePoison1Obj.showToolTip()' onmouseout="ttClear()" onclick="roguePoison1Obj.buyGuildUpgrade()"></div>
                    <div id="roguePoison2" class="roguePoison2 shopItem shadowedItem shopHidden" onmouseover='roguePoison2Obj.showToolTip()' onmouseout="ttClear()" onclick="roguePoison2Obj.buyGuildUpgrade()"></div>
                    <div id="roguePoison3" class="roguePoison3 shopItem shadowedItem shopHidden" onmouseover='roguePoison3Obj.showToolTip()' onmouseout="ttClear()" onclick="roguePoison3Obj.buyGuildUpgrade()"></div>
                    <div id="roguePoison4" class="roguePoison4 shopItem shadowedItem shopHidden" onmouseover='roguePoison4Obj.showToolTip()' onmouseout="ttClear()" onclick="roguePoison4Obj.buyGuildUpgrade()"></div>


                    <div id="etherealEdge" class="etherealEdge shopItem shadowedItem" onmouseover='etherealEdgeObj.showToolTip()' onmouseout="ttClear()" onclick="etherealEdgeObj.buyRateUpgradeItem()"></div>
                </div>
            </div>
            <div id="inventoryWrapper" class="inventoryWrapper">
                <div id="inventoryTabs" class="inventoryTabs">
                    <div id="markerTab" class="markerTab"></div>
                    <div id="playerTab" class="playerTab" onclick="tabSwap(1)"></div>
                    <div id="upgradeTab" class="upgradeTab" onclick="tabSwap(2)"></div>
                </div>
                <div id="playerInventory" class="playerInventory"></div>
                <div id="upgradeInventory" class="upgradeInventory"></div>
            </div>
        </div>
        <div id="guildSection" class="guildSection">
            <div class="guildHeader">Guild graphics go here</div>
            <div class="guildWrapper">
                <div class="theGuild">
                    <div class="newbTT" onmouseover="newbObj.showToolTip()" onmouseout="ttClear()">
                        <div id="newb" class="newb shadowed gBevel" onclick="newbObj.buy()" style="background: url(art/newbieBtn0.png)">
                            <div class="newbCount gCount">0</div>
                            <div class="newbCost gCost">10</div>
                        </div>
                    </div>
                    <div class="mercTT" onmouseover="mercObj.showToolTip()" onmouseout="ttClear()">
                        <div id="merc" class="merc shadowed bStyle gBevel guildHidden" onclick="mercObj.buy()" style="background: url(art/mercBtn0.png)">
                            <div class="mercCount gCount"></div>
                            <div class="mercCost gCost"></div>
                        </div>
                    </div>
                    <div class="koboldsTT" onmouseover="koboldObj.showToolTip()" onmouseout="ttClear()">
                        <div id="kobold" class="kobold shadowed bStyle gBevel guildHidden" onclick="koboldObj.buy()" style="background: url(art/koboldBtn0.png)">
                            <div class="koboldCount gCount"></div>
                            <div class="koboldCost gCost"></div>
                        </div>
                    </div>
                    <div class="roguesTT" onmouseover="rogueObj.showToolTip()" onmouseout="ttClear()">
                        <div id="rogue" class="rogue shadowed bStyle gBevel guildHidden" onclick="rogueObj.buy()" style="background: url(art/rogueBtn0.png)">
                            <div class="rogueCount gCount"></div>
                            <div class="rogueCost gCost"></div>
                        </div>
                    </div>
                    <div class="proHunterTT" onmouseover="proHunterObj.showToolTip()" onmouseout="ttClear()">
                        <div id="proHunter" class="proHunter shadowed bStyle gBevel guildHidden" onclick="proHunterObj.buy()" style="background: url(art/proHunterBtn0.png)">
                            <div class="proHunterCount gCount"></div>
                            <div class="proHunterCost gCost"></div>
                        </div>
                    </div>
                    <div class="jRPGProtagTT" onmouseover="jRPGProtagObj.showToolTip()" onmouseout="ttClear()">
                        <div id="jRPGProtag" class="jRPGProtag shadowed bStyle gBevel guildHidden" onclick="jRPGProtagObj.buy()" style="background: url(art/jRPGProtagBtn0.png)">
                            <div class="jRPGProtagCount gCount"></div>
                            <div class="jRPGProtagCost gCost"></div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>
    <div id="updateSection" class="updateSection">
        <form action="https://trello.com/b/J6pqmDN8/clicker-game">
            <input type="submit" value="Trello Board" id="trelloBtn" class="trelloBtn" />
        </form><br>
        <!-- <form action="https://ko-fi.com/amortes">
            <input type="submit" value="Donate~" id="donationBtn" class="donationBtn" />
        </form> -->
        <div class="kofiWidget">
            <script type='text/javascript' src='https://ko-fi.com/widgets/widget_2.js'></script>
            <script type='text/javascript'>
                kofiwidget2.init('Support Me on Ko-fi', '#29abe0', 'K3K01G35P');
                kofiwidget2.draw();
            </script>
        </div>

        <br>
        <p class="updatePara">Thanks for checking out my game! This is currently a work in progress, and I will be attempting to update daily until I feel like the game is in a playable and balanced state. <br><br> If you like my work, consider donating with the link at the
            top!
        </p>
        <ol><u><b>Update 2/29/2020</b></u>
            <li>Did a little balance testing, and added a few more items. Still more to come of both!</li>
            <li>Updated the dragon animation</li>
            <li>if you'd like to provide any feedback, feel free to <a href="https://twitter.com/Amortes1">drop me a tweet!</a></li>
        </ol>
        <ol><b><u>Update 2/27/2020</u></b>
            <li>Added an inventory panel, where you can see purchased items and guild upgrades!</li>
            <li>added lots of items! Every 10 of a recruit you hire unlocks a new item, to an extent. item names/descriptions pending, and many more to come!</li>
        </ol>
        <ol><u><b>Update 2/26/2020</u></b>
            <li>Expanded on the guild upgrade framework to make way for multiple tiers of upgrades! What does this mean? MORE KOBOLD HATS!</li>
            <li>added more kobold hats.</li>
            <li>did an overhaul of the save and load functions. you won't see any difference, but its a lot easier for me to add new items and guild recruits.</li>
            <li>Added a patch version check to save files. This is a temporary solution that will be removed later. What this means is, if an old save file would break the game in a future update, it will simply not load the save file (this does mean you'll
                lose progress, but a better solution will be implemented before I consider this game out of prototype/alpha phase)</li>
        </ol>
        <ol><u><b>Update 2/25/2020</b></u>
            <li>Added the framework for guild upgrade items!</li>
            <li>added kobold hats. very important. Hat styles pending.</li>
            <li>updated the dragon art slightly</li>
        </ol>
        <ol><b><u>Update 2/24/2020</u></b>
            <li>slapped together a <a href="https://trello.com/b/J6pqmDN8/clicker-game">trello board</a> where you can check out a more in depth list of things that are planned and being worked on</li>
            <li>updated the dragon art! now slightly animated.</li>
        </ol>
        <ol><b><u>Update 2/23/2020</u></b>
            <li>Added offline progression, for real this time!</li>
            <li>updated the placeholder dragon. Not final art.</li>
            <li>new item art</li>
            <li>added a few items to the shop</li>
        </ol>
        <ol><b><u>Update 2/22/2020</u></b>
            <li>Created a solution to progression slowing while tabbed out, as well as offline progression (Limited to 1 hour, but future items/other features will raise this limit!)</li>
            <li>Slowed down progression, added some items to make clicks more meaningful, more to come soon!</li>
            <li>implemented a critical hit system</li>
        </ol>
        <ol><b><u>Update 2/21/2020</u></b>
            <li>added options button along with update pane and several options.</li>
            <li>Rogue art</li>
        </ol><br>
        <ol><b><u>Planned updates</u></b>
            <li>add missing art</li>
            <li>add an inventory pane where you can see all your purchased items</li>
            <li>implement a critical hit system, along with items that trigger various effects on crit</li>
            <li>give kobolds hats</li>
            <li>a stat panel, including things such as gold per click, damage, crit rate, and other various things</li>
            <li>add many more things to the shop and recruit sections</li>
            <li>balance the gameplay</li>
            <li>Future-proof some code for balance updates</li>
        </ol>
    </div>
    <button id="optionsBtn" class="optionsBtn"></button>
    <div id="options" class="options">
        <input type="checkbox" id="textJitter">Gold text jitter off<br>
        <input type="checkbox" id="updateToggle">Show update pane<br>
        <button id="deleteSaveBtn" class="deleteSaveBtn">Delete Save</button>
    </div>



    <script>
        //misc global variables
        var critMulti = 2;
        var critChance = 1;
        var afgLimit = 3.6e+6;
        var GAME_TICK = 1; //interval speed
        var gameInterval;
        var smallUpdateTime = 0;
        var bigUpdateTime = 0;
        var saveUpdateTime = 0;
        var currentInterval
        var delta
        var smallInterval
        var largeInterval
        var oldInterval
        var fpsInterval
        var fpsUpdate = 0
        var ttWindow = QS(".toolTipWindow")
        var gDisplay = QS(".goldDisplay")
        var playerName = QS(".playerName")
        var gold = 0
        var upgrades = 0
        var gpc = 1
        var gps = 0
        var flatClickUpgrades = 0
        var rateClickUpgrades = 0
        const theDragon = document.getElementById("theDragon")
        theDragon.addEventListener('click', dClicked)


        function QS(e) {
            return document.querySelector(e)
        }

        class guildRecruit {
            constructor(type, cost, count, costEle, countEle, costMult, multFloor, gpsI, title, desc1, desc2, desc3) {
                this.type = type
                this.cost = cost
                this.count = count
                this.costEle = costEle
                this.countEle = countEle
                this.costMult = costMult
                this.multFloor = multFloor
                this.gpsI = gpsI
                this.title = title
                this.desc1 = desc1
                this.desc2 = desc2
                this.desc3 = desc3
            }

            priceCheckGuild() {
                if (this.cost <= gold) {
                    this.type.classList.remove("shadowed")
                } else {
                    this.type.classList.add("shadowed")
                }
            }

            buy() {
                if (gold >= this.cost) {
                    gold = gold - this.cost
                    this.count = this.count + 1
                    this.cost = this.cost + Number((this.cost * this.costMult).toFixed(0))
                    if (this.count >= 50) {
                        this.cost = this.cost + Number((this.cost * (this.count / 1000)).toFixed(0))
                    }
                    this.costMult = this.costMult - 0.05
                    if (this.costMult < this.multFloor) {
                        this.costMult = this.multFloor
                    }
                    QS(this.countEle).innerText = this.count
                    QS(this.costEle).innerText = this.cost
                    gps = gps + this.gpsI
                    gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                    gpsDisplay.innerHTML = `Gold per second : ${gps.toFixed(2)}`
                }

            }
            update() {
                QS(this.countEle).innerText = this.count
                QS(this.costEle).innerText = this.cost
                this.type.classList.remove("guildHidden")
            }
            reveal() {
                if (gold * 2 >= this.cost) {
                    this.type.classList.remove("guildHidden")
                    QS(this.countEle).innerText = this.count
                    QS(this.costEle).innerText = this.cost
                }
            }
            showToolTip() {
                ttWindow.style.display = "block"
                ttWindow.childNodes[1].innerText = ""
                ttWindow.childNodes[2].src = ""
                ttWindow.childNodes[4].innerText = this.title
                ttWindow.childNodes[7].innerText = this.desc1 + String(this.desc2) + this.desc3
            }
        }

        class shopItem {
            constructor(type, cost, title, desc, crit, mult, guildObj, revealAt, upgradeTier) {
                this.type = type
                this.cost = cost
                this.title = title
                this.desc = desc
                this.crit = crit
                this.mult = mult
                this.guildObj = guildObj
                this.revealAt = revealAt
                this.upgradeTier = upgradeTier
            }
            priceCheckItem() {
                if (this.cost <= gold) {
                    this.type.classList.remove("shadowedItem")
                } else {
                    this.type.classList.add("shadowedItem")
                }
            }
            buyFlatUpgradeItem() {
                if (this.cost <= gold) {
                    gold = gold - this.cost
                    flatClickUpgrades++
                    critChance = critChance + this.crit
                    critMulti = critMulti + this.mult
                    this.type.classList.add("inInventory")
                    $('.playerInventory').append(this.type)
                    this.type.removeAttribute("onclick")
                }
            }
            buyRateUpgradeItem() {
                if (this.cost <= gold) {
                    gold = gold - this.cost
                    rateClickUpgrades = rateClickUpgrades + 0.01
                    critChance = critChance + this.crit
                    critMulti = critMulti + this.mult
                    this.type.classList.add("inInventory")
                    $('.playerInventory').append(this.type)
                    this.type.removeAttribute("onclick")
                }
            }
            revealItem() {
                if (gold * 2 >= this.cost) {
                    this.type.classList.remove("shopHidden")
                }
            }
            revealUpgrade() {
                if (this.guildObj.count >= this.revealAt) {
                    this.type.classList.remove("shopHidden")
                }
            }
            showToolTip() {
                ttWindow.style.display = "block"
                ttWindow.childNodes[1].innerText = this.cost
                ttWindow.childNodes[2].src = "art/coinStack.png"
                ttWindow.childNodes[4].innerText = this.title
                ttWindow.childNodes[7].innerText = this.desc
            }
            buyGuildUpgrade() {
                if (this.cost <= gold) {
                    gold = gold - this.cost
                    gpsDisplay.innerHTML = `Gold per second : ${gps.toFixed(2)}`
                    gps = gps + (this.guildObj.count * this.guildObj.gpsI)
                    this.guildObj.gpsI = this.guildObj.gpsI * 2
                    this.guildObj.desc2 = this.guildObj.desc2 * 2
                    if (typeof this.upgradeTier !== "undefined") {
                        let str = this.guildObj.type.style.backgroundImage
                        str = str.slice(0, -7)
                        this.guildObj.type.style.backgroundImage = `${str}` + `${this.upgradeTier}` + `.png")`
                    }
                    this.type.classList.add("inInventory")
                    $('.upgradeInventory').append(this.type)
                    this.type.removeAttribute("onclick")
                }
            }
        }

        //Clicking the dragon
        function dClicked(e) {
            posX = e.clientX
            posY = e.clientY
            let rgn = rngInt(1, 100 / critChance)
            if (rgn == 1) {
                finalGpc = (gpc + flatClickUpgrades + (gps * rateClickUpgrades)) * critMulti
                gold = gold + finalGpc
                gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                var goldAnim = $('<div  class="animation anim" style="top:' + (posY - 10) + 'px; left:' + (posX + rngInt(-25, -5)) + 'px">+' + finalGpc.toFixed(2) + '</div>');
                var damageAnim = $('<div  class="critDmgAnim anim" style="top:' + (posY + rngInt(0, 20)) + 'px; left:' + (posX + rngInt(0, 40)) + 'px"></div>');
            } else {
                finalGpc = gpc + flatClickUpgrades + (gps * rateClickUpgrades)
                gold = gold + finalGpc
                gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                var goldAnim = $('<div  class="animation anim" style="top:' + (posY - 10) + 'px; left:' + (posX + rngInt(-25, -5)) + 'px">+' + finalGpc.toFixed(2) + '</div>');
                var damageAnim = $('<div  class="dmgAnim anim" style="top:' + (posY + rngInt(0, 20)) + 'px; left:' + (posX + rngInt(0, 40)) + 'px"></div>');
            }
            $('#animations').append(goldAnim);
            $('#animations').append(damageAnim);
            $('#animations').on("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd", '.anim',
                function() {
                    $(this).off();
                    $(this).remove();
                });

        }

        //Guild Objs-----------
        //elementID, cost, count, costElementClass, CountElementClass, costMultiplier, multiplierFloor, gpsIncrease, tooltip title, tooltip description 1 2 3

        const newbObj = new guildRecruit(newb, 10, 0, ".newbCost", ".newbCount", 0.25, 0.04, 0.1, "Newbie", "Ready for their first adventure,\ncomplete with red shirt!\n\n+", 0.1, " gold per second")
        const mercObj = new guildRecruit(merc, 100, 0, ".mercCost", ".mercCount", 0.15, 0.07, 1, "Mercenary", "A slightly more experienced adventurer.\nOnly slighty.\n\n+", 1, " gold per second")
        const koboldObj = new guildRecruit(kobold, 500, 0, ".koboldCost", ".koboldCount", 0.25, 0.05, 5, "Kobold", "I'm not sure how they got past guild\nregistration, but they're really good at\nhoarding gold!\n\n+", 5, " gold per second")
        const rogueObj = new guildRecruit(rogue, 5000, 0, ".rogueCost", ".rogueCount", 0.3, 0.1, 20, "Rogue", "Stealing gold is literally their job.\n\n+", 20, " gold per second")
        const proHunterObj = new guildRecruit(proHunter, 200000, 0, ".proHunterCost", ".proHunterCount", 0.15, 0.2, 100, "Professional Hunter", "The best gear.\nThe best stats.\nThe best DPS.\nbut at what cost?\n\n+", 100, " gold per second\n+1 second-hand embarassment.")
        const jRPGProtagObj = new guildRecruit(jRPGProtag, 1300000, 0, ".jRPGProtagCost", ".jRPGProtagCount", 0.3, 0.25, 999, "jRPG Protagonist", "\n彼は殺されるなどの小さなことで死ぬことはありません。\n\n+", 999, " gold per second", 1)


        //Item Objs-------------
        //type, cost, tooltip title, tooltip description, critical chance increase, additional crit multiplier, elementid, guildObjName
        //Flat Upgrade Items
        const ironSwordObj = new shopItem(ironSword, 300, "Iron Sword", "A basic iron sword. Cheap and effective.\n\n+1 Gold per click", 0, 0)
        const steelSwordObj = new shopItem(steelSword, 3000, "Steel Sword", "A slight improvment.\n\n+1 Gold per click\n+25% more gold on crit", 0, 0.25)
        const boneSwordObj = new shopItem(boneSword, 30000, "Bone Sword", "The shop keeper swears it's stronger than steel...\nNumbers don't lie, I guess.\n\n+1 Gold per click\n+1% crit rate\n+25% more gold on crit", 1, 0.25)
        const greatSwordObj = new shopItem(greatSword, 300000, "Great Sword", "It's great.\n\n+1 Gold per click\n+3% crit rate\n+50% more gold on crit", 3, 0.5)

        //Rate Upgrade Items
        const goldenLoopObj = new shopItem(goldenLoop, 15000, "Golden Loop", "Round it goes, gold through and through\nnever ending...\n\n+1% of your GPS per click", 0, 0)
        const ringOfMidasObj = new shopItem(ringOfMidas, 250000, "Ring of Midas", "Every swing of your sword creates gold!\nWhat even is inflation?!\n\n+1% of your GPS per click", 0, 0)

        //Crit upgrades

        //the final item
        const etherealEdgeObj = new shopItem(etherealEdge, 9999999999, "Ethereal Edge", "On display as the shops most prestigious weapon.\nThe blade looks as if it could cut through anything.\n\n+1 True damage (Not yet implemented.)\n+10% crit rate\n+300% more gold on crit", 10, 3)

        //guild upgrades
        const newbManual1Obj = new shopItem(newbManual1, 20, "Introduction to adventuring", "A helpful guide for newbies. Printed in mass.\n\nNewbies are twice as efficient", 0, 0, newbObj, 10)
        const newbManual2Obj = new shopItem(newbManual2, 80, "Swordfighting for dummies", "Another guide for your newbie recruits.\n\nNewbies are twice as efficient", 0, 0, newbObj, 20)
        const newbManual3Obj = new shopItem(newbManual3, 390, "Yolo's guide to monsters", "Not the best strategies, but it has nice art.\n\nNewbies are twice as efficient", 0, 0, newbObj, 30)
        const newbManual4Obj = new shopItem(newbManual4, 1300, "Xantac's guide to everything", "Everything you did, and didn't need to know,\nand then some.\n\nNewbies are twice as efficient", 0, 0, newbObj, 40)
        const newbManual5Obj = new shopItem(newbManual5, 4200, "A druids guide to healing", "Teach your newbies to cure wounds!\n\nNewbies are twice as efficient", 0, 0, newbObj, 50)
        const newbManual6Obj = new shopItem(newbManual6, 12500, "Guide to necromancy", "When its too late for healing......\n\nNewbies are twice as efficient", 0, 0, newbObj, 60)
        const newbManual7Obj = new shopItem(newbManual7, 30000, "Introduction to spellcasting", "Contains useful offensive spells such as fireball,\nand water...\n\nNewbies are twice as efficient", 0, 0, newbObj, 70)
        const newbManual8Obj = new shopItem(newbManual8, 130000, "101 things you didn't\nknow about dragons", "Appearantly they are Immune to magic....\nwho knew.... \n\nNewbies are twice as efficient", 0, 0, newbObj, 80)
        const newbManual9Obj = new shopItem(newbManual9, 850000, "Xushin's guide to economic equilibrium", "An enourmous volume of compiled knowledge about supply and demand,\nsocial networking and the endless facets of individual\neconomic growth!\n\nYou're not quite sure why you need this\nbut you sure do feel smarter after reading it!\n\nNewbies are twice as efficient", 0, 0, newbObj, 90)
        const newbManual10Obj = new shopItem(newbManual10, 3800000, "Raiding and you", "A guide to teach your newbies how to\norganize their own raiding parties.\nBy L.J.\n\nNewbies are twice as efficient", 0, 0, newbObj, 100)

        const mercGear1Obj = new shopItem(mercGear1, 2800, "Cheap swords", "Slightly better than what they were using.\n\nMercenaries are twice as efficient", 0, 0, mercObj, 10)
        const mercGear2Obj = new shopItem(mercGear2, 7500, "Cheap shields", "Best to be prepared!\n\nMercenaries are twice as efficient", 0, 0, mercObj, 20)
        const mercGear3Obj = new shopItem(mercGear3, 22000, "Cheap helmets", "They might as well have been wearing tin foil hats before.\n\nMercenaries are twice as efficient", 0, 0, mercObj, 30)
        const mercGear4Obj = new shopItem(mercGear4, 86000, "Blue tunics", "They might not get eaten now!\n\nMercenaries are twice as efficient", 0, 0, mercObj, 40)
        const mercGear5Obj = new shopItem(mercGear5, 180000, "Knight's visor", "Sturdy, reliable, and knightly.\n\nMercenaries are twice as efficient", 0, 0, mercObj, 50)

        const koboldHat1Obj = new shopItem(koboldHat1, 25000, "Party hat", "Make any dragon den raid feel like a party!\n\nKobolds are twice as efficient", 0, 0, koboldObj, 10, 1)
        const koboldHat2Obj = new shopItem(koboldHat2, 50000, "Miniature crown", "Make every kobold feel like royalty.\nHopefully it doesn't go to their heads.\n\nKobolds are twice as efficient", 0, 0, koboldObj, 20, 2)
        const koboldHat3Obj = new shopItem(koboldHat3, 210000, "Fancy hat", "Increases Kobold productivity two fold!\n\nKobolds are twice as efficient", 0, 0, koboldObj, 30, 3)
        const koboldHat4Obj = new shopItem(koboldHat4, 900000, "Legendary Hero's cap", "Kobolds feel more heroic and inspired\nto adventure with this hat.\n\nKobolds are twice as efficient", 0, 0, koboldObj, 40, 4)

        const roguePoison1Obj = new shopItem(roguePoison1, 75000, "Nightshade coating", "A poison coating for rogue's daggers\nthat puts even the largest beasts to sleep.\nEach bottle is quite expensive, but they swear\nYou're getting a bargain!\n\nRogues are twice as efficient", 0, 0, rogueObj, 10)
        const roguePoison2Obj = new shopItem(roguePoison2, 500000, "Mandragora mix", "They say those who hear the mandragora's scream\ndie instantly. Made from it's roots, this poison\nshould have the same effect...\ntheoretically...\nResults not guaranteed.\n\nRogues are twice as efficient", 0, 0, rogueObj, 20)
        const roguePoison3Obj = new shopItem(roguePoison3, 2400000, "Basalisk's bite", "Able to turn any foe to stone.\nThey swear its working, just takes longer\nagainst bigger creatures...\n\n\nRogues are twice as efficient", 0, 0, rogueObj, 30)
        const roguePoison4Obj = new shopItem(roguePoison4, 8000000, "Serpent's sting", "From the most venomous of snakes\nthis coating causes slow paralysis.\nYou're starting to wonder if actually need\nany of these...\n\nRogues are twice as efficient", 0, 0, rogueObj, 40)



        //Object arrays for updates and save/load
        const guildObjs = [newbObj, mercObj, koboldObj, rogueObj, proHunterObj, jRPGProtagObj]
        const playerItemObjs = [
            ironSwordObj, steelSwordObj, boneSwordObj, greatSwordObj,
            goldenLoopObj, ringOfMidasObj,
            etherealEdgeObj
        ]
        const guildItemObjs = [
            newbManual1Obj, newbManual2Obj, newbManual3Obj, newbManual4Obj, newbManual5Obj, newbManual6Obj, newbManual7Obj, newbManual8Obj, newbManual9Obj, newbManual10Obj,
            mercGear1Obj, mercGear2Obj, mercGear3Obj, mercGear4Obj, mercGear5Obj,
            koboldHat1Obj, koboldHat2Obj, koboldHat3Obj,
            roguePoison1Obj, roguePoison2Obj, roguePoison3Obj, roguePoison4Obj
        ]

        const patchVersion = 0.06


        //Misc Functions------------------------------------------
        function changeName() {
            playerName.innerText = prompt("What is your name?")
        }

        function ttClear() {
            ttWindow.style.display = "none"
        }

        function rngInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min; //The maximum is inclusive and the minimum is inclusive 
        }

        function tabSwap(v) {
            switch (v) {
                case 1:
                    QS(".playerTab").style = "z-index:299;"
                    QS(".playerInventory").style = "z-index:299;"
                    break;
                case 2:
                    QS(".playerTab").style = "z-index:301;"
                    QS(".playerInventory").style = "z-index:301;"
                    break;
            }
        }
        //--------------------------------------------------------


        //Game tick functions-------------------------------------
        function onGameTick() { //The core game interval
            currentInterval = Date.now();
            delta = currentInterval - oldInterval; // currently unused, but can be used in the future to handle things
            oldInterval = currentInterval; // that happen while the game is closed

            smallInterval = currentInterval - smallUpdateTime; //this starts as 0
            largeInterval = currentInterval - bigUpdateTime; //this too
            fpsInterval = currentInterval - fpsUpdate;
            saveInterval = currentInterval - saveUpdateTime;
            if (fpsInterval >= 1000 / 30) {
                fpsUpdate = currentInterval;
            }
            if (delta >= 110) {
                updateGoldAFK(delta);
            } else if (smallInterval >= 98) {
                smallUpdateTime = currentInterval;
                updateGold();
            }

            if (largeInterval >= 250) {
                bigUpdateTime = currentInterval;
                updateOtherStuff();

            }
            if (saveInterval >= 5000) {
                saveUpdateTime = currentInterval;
                saveGame();
            }
        };

        function updateGold() {
            gold = gold + (gps / 10)
            gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
            gpsDisplay.innerHTML = `Gold per second : ${gps.toFixed(2)}`
        }

        function updateGoldAFK(delta) { // delta 500 example... gold + (gps/1000)*delta
            if (delta <= afgLimit) {
                gold = gold + (gps / 1000) * delta
                gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                gpsDisplay.innerHTML = `Gold per second : ${gps.toFixed(2)}`
            } else {
                gold = gold + (gps / 1000) * afgLimit
                gDisplay.innerHTML = `Gold: ${gold.toFixed(0)}`
                gpsDisplay.innerHTML = `Gold per second : ${gps.toFixed(2)}`
            }
        }

        function updateOtherStuff() {
            guildObjs.forEach(i => {
                i.priceCheckGuild()
                i.reveal()
            });

            playerItemObjs.forEach(i => {
                i.priceCheckItem()
                i.revealItem()
            });
            guildItemObjs.forEach(i => {
                i.priceCheckItem()
                i.revealUpgrade()
            })
        }
        //--------------------------------------------------------

        //Save and Load game functions ---------------------------
        function saveGame() {
            var save = {
                patchVersion: patchVersion,

                //------------misc saved variables
                textJitter: document.getElementById("textJitter").checked,
                oldInterval: oldInterval,
                gold: gold,
                gps: gps,
                flatClickUpgrades: flatClickUpgrades,
                rateClickUpgrades: rateClickUpgrades,
                critChance: critChance,
                critMulti: critMulti,

                //------------recruits
                guildSaves: guildObjs,
                guildClassLists: guildObjs.map(x => x.type.classList.value),
                guildBGs: guildObjs.map(x => x.type.style.backgroundImage),

                //------------items
                playerItems: playerItemObjs.map(x => x.type.classList.value),
                upgradeItems: guildItemObjs.map(x => x.type.classList.value),
            }
            localStorage.setItem("save", JSON.stringify(save));
            //console.log('saved')
        }

        function loadGame() {
            var savegame = JSON.parse(localStorage.getItem("save"));

            if (savegame !== null) {
                if (savegame.patchVersion != patchVersion) {
                    return;
                }
                oldInterval = savegame.oldInterval;
                if (typeof savegame.gold !== "undefined") gold = savegame.gold;
                if (typeof savegame.gps !== "undefined") gps = savegame.gps;
                if (typeof savegame.flatClickUpgrades !== "undefined") flatClickUpgrades = savegame.flatClickUpgrades;
                if (typeof savegame.rateClickUpgrades !== "undefined") rateClickUpgrades = savegame.rateClickUpgrades;
                if (typeof savegame.critChance !== "undefined") critChance = savegame.critChance;
                if (typeof savegame.critMulti !== "undefined") critMulti = savegame.critMulti;
                if (typeof savegame.playerName !== "undefined") playerName.innerText = savegame.playerName;
                document.getElementById("textJitter").checked = savegame.textJitter;
                savegame.guildSaves.forEach((e, i) => rLoadTest(e, i, guildObjs))
                savegame.guildClassLists.forEach((e, i) => cLoadTest(e, i, guildObjs))
                savegame.guildBGs.forEach((e, i) => imgLoadTest(e, i, guildObjs))
                savegame.playerItems.forEach((e, i) => piLoadTest(e, i, playerItemObjs))
                savegame.upgradeItems.forEach((e, i) => giLoadTest(e, i, guildItemObjs))
            }

        }

        function rLoadTest(e, i, obj) {
            if (typeof e.cost !== "undefined") {
                obj[i].cost = e.cost
            }
            if (typeof e.count !== "undefined") {
                obj[i].count = e.count
            }
            if (typeof e.gpsI !== "undefined") {
                obj[i].gpsI = e.gpsI
            }
            if (typeof e.desc2 !== "undefined") {
                obj[i].desc2 = e.desc2
            }
        }

        function cLoadTest(e, i, obj) {
            if (e.search("guildHidden") == -1) {
                obj[i].update()
            }
        }

        function imgLoadTest(e, i, obj) {
            if (typeof e !== "undefined") {
                obj[i].type.style.backgroundImage = e
            }
        }

        function piLoadTest(e, i, obj) {
            if (typeof e !== "undefined") {
                obj[i].type.classList = e
                if (e.search("inInventory") !== -1) {
                    $('.playerInventory').append(obj[i].type)
                    obj[i].type.removeAttribute("onclick")
                }
            }
        }

        function giLoadTest(e, i, obj) {
            if (typeof e !== "undefined") {
                obj[i].type.classList = e
                if (e.search("inInventory") !== -1) {
                    $('.upgradeInventory').append(obj[i].type)
                    obj[i].type.removeAttribute("onclick")
                }
            }
        }

        function deleteSave() {
            localStorage.removeItem("save")
            window.location.reload(false);
        }

        //--------------------------------------------------------

        function onStartup() {
            if (gameInterval) { //if an interval is set for some reason, clear it
                clearInterval(gameInterval);
                gameInterval = null;
            }
            gameInterval = setInterval(onGameTick, GAME_TICK); // do the things in onGameTick at the rate of GAME_TICK

        }

        function onShutdown() {
            if (gameInterval) {
                clearInterval(gameInterval);
                gameInterval = null;
            }
        }

        //Stuff that happens on page load
        loadGame();
        onStartup();
        $("#options").hide()

        if (document.getElementById("textJitter").checked) {
            $(".goldDisplay").css({
                "position": "absolute",
                "left": "246px"
            })
            $(".gpsDisplay").css({
                "position": "absolute",
                "left": "228px",
                "bottom": "3px"
            })
        }
        document.getElementById("updateToggle").checked = true;
        //$("#updateSection").hide()

        $("#optionsBtn").click(function() {
            $("#options").toggle();
        })

        $("#deleteSaveBtn").click(deleteSave)
        $("#textJitter").change(
            function() {
                if (this.checked) {
                    $(".goldDisplay").css({
                        "position": "absolute",
                        "left": "246px"
                    })
                    $(".gpsDisplay").css({
                        "position": "absolute",
                        "left": "228px",
                        "bottom": "3px"
                    })
                } else {
                    $(".goldDisplay").css({
                        "position": "static"
                    })
                    $(".gpsDisplay").css({
                        "position": "static"
                    })
                }

            });
        $("#updateToggle").change(
            function() {
                $("#updateSection").toggle()
            }
        )

        //AFG Handlers
        window.addEventListener("focus", function(event) {
            onStartup();
        }, false);
        window.addEventListener("blur", function(event) {
            onShutdown();
        }, false);
    </script>
</body>

</html>